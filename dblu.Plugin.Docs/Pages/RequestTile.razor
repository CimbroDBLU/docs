@*
    Component for displaying a Tile with the incoming request
*@
@using dblu.Portale.Core.Infrastructure.Identity.Classes
@using dblu.Portale.Core.Infrastructure.Identity.Services
@inject AuthenticationStateProvider _AuthenticationStateProvider
@inject dblu.Portale.Plugin.Docs.Services.ZipService _ZipService
@inject ILogger<RequestTile> _Logger
@inject IApplicationUsersManager _ApplicationUserManager


<Tile nTitle="@Number"
      nDescription="Richieste in arrivo"
      nLink="@Link"
      nIcon="fas fa-ruler"
      nBackColor="#ffc107"
      nForeColor="black"></Tile>


@code {
    /// <summary>
    /// Number of the incoming request
    /// </summary>
    public string Number { get; set; }

    /// <summary>
    /// Link to Open
    /// </summary>
    public string Link { get; set; }

    /// <summary>
    /// On Init component
    /// </summary>
    protected override async void OnInitialized()
    {
        Stopwatch SW = Stopwatch.StartNew();
        var authState = await _AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        Number = _ZipService.CountZipInArrivo("REQ", user.Claims).ToString();

         ApplicationUser AU = _ApplicationUserManager.GetUser(user.Identity.Name);
        string Version=AU.Properties["VERSION"]?.ToString() ?? "STANDARD";
        Link="Files/REQ/Inbox";
        if(Version=="BETA") Link="Files/REQ/Inbox";
        if(Version=="LEGACY") Link="ZipView/ZipInArrivo?Tipo=REQ";
        _Logger.LogDebug($"RequestTile.OnInitialized: {Number} requests in {SW.ElapsedMilliseconds} ms");
    }
}