@model dblu.Portale.Plugin.Docs.ViewModels.DocumentViewModel

@inject dblu.Portale.Plugin.Docs.Services.AllegatiService _doc

@using dblu.Portale.Plugin.Docs.Models
@using Newtonsoft.Json.Linq
@using Newtonsoft.Json
@using dblu.Portale.Core.UI 
@using Kendo.Mvc.UI
@using Syncfusion.EJ2
@addTagHelper *, Kendo.Mvc

@addTagHelper "*, Syncfusion.EJ2"

@{
    var Title = "Editor allegato";
}


@(await Html.RenderComponentAsync<PageTitle>(RenderMode.Server,  new { nTitle = Title}))

<div class="e-card">
    <div class="e-card-header">
        <div class="e-card-header-caption">
            <div class="e-card-header-title">
                @Title
            </div>
        </div>
    </div>
    <div class="e-card-separator"></div>
    <div class="e-card-content">
        <section class="content">
            
                <div class="row">
                    <div class="col">
                        <div class="card card-outline card-secondary col">
                            <div class="card-header p-1">
                                <div class="card-title">
                                    Gestione Documento
                                </div>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="card-body">
                                <form class='form-horizontal'>
                                    <div class="row">
                                        <div class="col-6">


                                            <div class='form-group row'>
                                                <label for='' class='col-2 col-form-label'>ID Documento</label>
                                                <div class='col-10'>
                                                    <input type='text' class='form-control' id='' placeholder='' value='@Model.Allegato.Id' disabled>
                                                </div>
                                            </div>
                                            <div class='form-group row'>
                                                <label for='' class='col-2 col-form-label'>Creato il</label>
                                                <div class='col-10'>
                                                    <input type='datetime' class='form-control' id='' placeholder='' value='@Model.Allegato.DataC' disabled>
                                                </div>

                                            </div>
                                            <div class='form-group row'>
                                                <label for='' class='col-2 col-form-label'>Utente Creazione</label>
                                                <div class='col-10'>
                                                    <input type='text' class='form-control' id='' placeholder='Nome' value='@Model.Allegato.UtenteC' disabled>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class='form-group row'>
                                                <label for='' class='col-2 col-form-label'>Descrizione</label>
                                                <div class='col-10'>
                                                    <input type='text' class='form-control' id='' placeholder='' value='@Model.Allegato.Descrizione' disabled>
                                                </div>

                                            </div>
                                            <div class='form-group row'>
                                                <label for='' class='col-2 col-form-label'>Modificato il</label>
                                                <div class='col-10'>
                                                    <input type='datetime' class='form-control' id='' placeholder='' value='@Model.Allegato.DataUM' disabled>
                                                </div>

                                            </div>
                                            <div class='form-group row'>
                                                <label for='' class='col-2 col-form-label'>Utente Ultima Modifica</label>
                                                <div class='col-10'>
                                                    <input type='text' class='form-control' id='' placeholder='Nome' value='@Model.Allegato.UtenteUM' disabled>
                                                </div>
                                            </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <button type="button" onclick="saveAnnotations();" class="btn btn-success btn-lg">Salva Annotazioni</button>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col">
                        <div>
                            <ejs-pdfviewer id="pdfviewer" serviceUrl="/api/PdfViewer" documentPath="@Model.Allegato.Id"
                                           enablePrint="true"
                                           documentLoad="documentLoaded"
                                           annotationAdd="annotationAdd"
                                           enableStampAnnotations="false"
                                           locale="it-IT" height="1000px"
                                           downloadFileName="@string.Concat(@Model.Allegato.Id.ToString(),".pdf")">
                            </ejs-pdfviewer>
                        </div>
                    </div>
                </div>


        </section>
    </div>
</div>


<script src="~/Scripts/dblupdf.js"></script>
<script>



    $(document).ready(function () {

        //$("#pdfviewer_comment").remove();
        var pdfViewer = document.getElementById('pdfviewer').ej2_instances[0];
        pdfViewer.stickyNotesSettings.author = '@User.Identity.Name' //'@User.Identity.Name.Replace('.',' ')';
        pdfViewer.strikethroughSettings.author = '@User.Identity.Name';
        pdfViewer.underlineSettings.author = '@User.Identity.Name';
        pdfViewer.highlightSettings.author = '@User.Identity.Name';
        pdfViewer.annotationSettings.author = '@User.Identity.Name';
        pdfViewer.freeTextSettings.author = '@User.Identity.Name';

        //pdfViewer.measurementSettings.displayUnit = "mm";
        //pdfViewer.measurementSettings.conversionUnit = "mm";


    });

     function importAnnotations() {

        var pdfViewer = document.getElementById('pdfviewer').ej2_instances[0];
        pdfViewer.importAnnotation('@Model.Allegato.Id');
    }

    function annotationAdd(e) {
       // alert("The signature is added to the PDF document successfully");
    }


    function saveAnnotations() {

        var pdfViewer = document.getElementById('pdfviewer').ej2_instances[0];
        pdfViewer.exportAnnotation();
    }

    function documentLoaded(args) {
        //alert("The document" + args.fileName + "is ready to view");
        importAnnotations()
    }


</script>
<style>

    #menuitem_2 {
        display: none;
    }

    #pdfviewer_openContainer {
        display: none
    }


    html body #container {
        width: 100% !important;
    }

    .container {
        height: 100vh; /* For 100% screen height */
        width: 100vw; /* For 100% screen width */
    }

    .panel-wrap {
        background-color: #f5f5f5;
        border: 1px solid #e5e5e5;
        position: relative;
    }


    #main-content {
        overflow: hidden;
        margin: 0;
        padding: 20px;
        min-height: 580px;
        vertical-align: top;
    }
</style>

